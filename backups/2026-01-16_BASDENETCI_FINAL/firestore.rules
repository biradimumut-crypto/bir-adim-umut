rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ========== HELPER FUNCTIONS ==========
    
    /// KullanÄ±cÄ± kimlik doÄŸrulamasÄ± kontrolÃ¼
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // ðŸš¨ P1-2 REV.2: App Check enforcement Firebase Console'dan yÃ¶netilir
    // Rules iÃ§inde claim kontrolÃ¼ YAPILMAZ (yanlÄ±ÅŸ API)
    // Console â†’ App Check â†’ Enforcement â†’ Firestore â†’ Enforced
    
    /// KullanÄ±cÄ±nÄ±n kendi verilerine eriÅŸimi
    function isUser(uid) {
      return isAuthenticated() && request.auth.uid == uid;
    }
    
    /// Admin kontrolÃ¼
    function isAdmin() {
      return isAuthenticated() && 
             exists(/databases/$(database)/documents/admins/$(request.auth.uid)) &&
             get(/databases/$(database)/documents/admins/$(request.auth.uid)).data.is_active == true;
    }
    
    /// TakÄ±m liderini kontrol et
    function isTeamLeader(teamId) {
      return isAuthenticated() && 
             get(/databases/$(database)/documents/teams/$(teamId)).data.leader_uid == request.auth.uid;
    }
    
    /// KullanÄ±cÄ± takÄ±mda Ã¼ye mi?
    function isTeamMember(teamId) {
      return isAuthenticated() && 
             exists(/databases/$(database)/documents/teams/$(teamId)/team_members/$(request.auth.uid));
    }
    
    // ========== USERS KOLEKSIYONU ==========
    
    match /users/{userId} {
      // Herkes okuyabilir (sÄ±ralama amaÃ§lÄ±)
      allow read: if isAuthenticated();
      
      // ðŸš¨ BAÅžDENETÃ‡I FIX #1 REV.2: KullanÄ±cÄ± update WHITELIST + TÄ°P KONTROLÃœ
      // Sadece profil/ayar alanlarÄ± gÃ¼ncellenebilir
      // wallet_balance_hope, lifetime_earned_hope, carryover_*, referral_*, is_admin YASAK
      // ðŸš¨ daily_goal_steps iÃ§in tip (int) ve aralÄ±k (1000-100000) kontrolÃ¼
      allow update: if isUser(userId) &&
                      request.resource.data.diff(resource.data).affectedKeys()
                        .hasOnly([
                          // Profil alanlarÄ±
                          'display_name', 'photo_url', 'bio', 'phone_number',
                          // Tercihler
                          'theme_mode', 'language', 'notification_preferences',
                          'daily_goal_steps', 'privacy_settings',
                          // Health Kit entegrasyonu
                          'health_data_source', 'last_health_sync',
                          // FCM token
                          'fcm_token', 'fcm_token_updated_at',
                          // Durum alanlarÄ± (client gÃ¼nceller)
                          'last_active_at', 'app_version', 'device_info'
                        ]) &&
                      // ðŸš¨ BAÅžDENETÃ‡I FIX: daily_goal_steps tip + aralÄ±k kontrolÃ¼
                      (
                        !request.resource.data.diff(resource.data).affectedKeys().hasAny(['daily_goal_steps']) ||
                        (
                          request.resource.data.daily_goal_steps is int &&
                          request.resource.data.daily_goal_steps >= 1000 &&
                          request.resource.data.daily_goal_steps <= 100000
                        )
                      );
      
      // Admin kullanÄ±cÄ±larÄ± gÃ¼ncelleyebilir (ban, bakiye vb.)
      allow update: if isAdmin();
      
      // Admin kullanÄ±cÄ±yÄ± silebilir
      allow delete: if isAdmin();
      
      // ðŸš¨ BAÅžDENETÃ‡I FIX #2: Referral gÃ¼ncelleme KALDIRILDI
      // referral_bonus_steps ve referral_count sadece Cloud Function yazmalÄ±
      // Client bu alanlarÄ± yazamaz - applyReferral() fonksiyonu kullanÄ±lmalÄ±
      // KALDIRILDI: allow update: if isAuthenticated() && referral alanlarÄ±...
      
      // ðŸš¨ BAÅžDENETÃ‡I FIX #2: current_team_id gÃ¼ncelleme KALDIRILDI
      // Sadece joinTeam(), leaveTeam() Cloud Function'larÄ± yazmalÄ±
      // KALDIRILDI: allow update: if isAuthenticated() && current_team_id...
      
      // Yeni user doc oluÅŸtur (Sign Up sÄ±rasÄ±nda) - auth uid eÅŸleÅŸmesi yeterli
      allow create: if request.auth != null && request.auth.uid == userId;
      
      // ========== NOTIFICATIONS ALT KOLEKSÄ°YONU ==========
      
      match /notifications/{notificationId} {
        // Kendi bildirimleri oku
        allow read: if isUser(userId);
        
        // Bildirimi gÃ¼ncelle (Cloud Function tarafÄ±ndan)
        allow update: if isUser(userId);
        
        // Bildirimi sil (kullanÄ±cÄ± veya admin)
        allow delete: if isUser(userId) || isAdmin();
      }
      
      // ========== ACTIVITY_LOGS ALT KOLEKSÄ°YONU ==========
      
      match /activity_logs/{logId} {
        // Kendi aktivite geÃ§miÅŸini oku veya Admin okuyabilir
        allow read: if isUser(userId) || isAdmin();
        
        // ðŸš¨ KRÄ°TÄ°K FIX: Sadece kendi subcollection'Ä±na log yazabilir
        // Referral bonus loglarÄ± Cloud Function tarafÄ±ndan Admin SDK ile yazÄ±lÄ±r
        allow create: if isUser(userId) && 
                         request.resource.data.user_id == request.auth.uid;
        
        // Admin silebilir (kullanÄ±cÄ± silme iÃ§in)
        allow delete: if isAdmin();
      }
      
      // ========== ACTIVITY_LOG ALT KOLEKSÄ°YONU (Referral bonuslarÄ± iÃ§in) ==========
      
      match /activity_log/{logId} {
        // Kendi aktivite geÃ§miÅŸini oku veya Admin okuyabilir
        allow read: if isUser(userId) || isAdmin();
        
        // ðŸš¨ KRÄ°TÄ°K FIX: Sadece kendi subcollection'Ä±na log yazabilir
        // Referral bonus loglarÄ± Cloud Function tarafÄ±ndan Admin SDK ile yazÄ±lÄ±r
        allow create: if isUser(userId) && 
                         request.resource.data.user_id == request.auth.uid;
        
        // Admin silebilir (kullanÄ±cÄ± silme iÃ§in)
        allow delete: if isAdmin();
      }
      
      // ========== BADGES ALT KOLEKSÄ°YONU (Rozetler) ==========
      
      match /badges/{badgeId} {
        // Kendi rozetlerini oku veya Admin okuyabilir
        allow read: if isUser(userId) || isAdmin();
        
        // Rozet kazanÄ±ldÄ±ÄŸÄ±nda oluÅŸtur (kendi rozetini)
        allow create: if isUser(userId);
        
        // Rozeti "gÃ¶rÃ¼ldÃ¼" olarak iÅŸaretle
        allow update: if isUser(userId);
        
        // Admin silebilir (kullanÄ±cÄ± silme iÃ§in)
        allow delete: if isAdmin();
      }
      
      // ========== DAILY_STEPS ALT KOLEKSÄ°YONU ==========
      
      match /daily_steps/{dateKey} {
        // Kendi gÃ¼nlÃ¼k adÄ±m verilerini oku veya Admin okuyabilir
        allow read: if isUser(userId) || isAdmin();
        
        // AdÄ±m verisi oluÅŸtur/gÃ¼ncelle
        allow write: if isUser(userId);
        
        // Admin silebilir (kullanÄ±cÄ± silme iÃ§in)
        allow delete: if isAdmin();
      }
      
      // ========== AD_LOGS ALT KOLEKSÄ°YONU (KullanÄ±cÄ± Reklam GeÃ§miÅŸi) ==========
      
      match /ad_logs/{logId} {
        // Kendi reklam geÃ§miÅŸini oku veya Admin okuyabilir
        allow read: if isUser(userId) || isAdmin();
        
        // Reklam logu oluÅŸtur
        allow create: if isUser(userId);
        
        // Loglar gÃ¼ncellenemez
        allow update: if false;
        
        // Admin silebilir (kullanÄ±cÄ± silme iÃ§in)
        allow delete: if isAdmin();
      }
      
      // ========== SESSIONS ALT KOLEKSÄ°YONU (Oturum Takibi) ==========
      
      match /sessions/{sessionId} {
        // Kendi oturumlarÄ±nÄ± oku veya Admin okuyabilir
        allow read: if isUser(userId) || isAdmin();
        
        // Oturum oluÅŸtur/gÃ¼ncelle
        allow write: if isUser(userId);
        
        // Admin silebilir (kullanÄ±cÄ± silme iÃ§in)
        allow delete: if isAdmin();
      }
      
      // ========== DAILY_SESSIONS ALT KOLEKSÄ°YONU ==========
      
      match /daily_sessions/{dateKey} {
        // Kendi gÃ¼nlÃ¼k oturum verilerini oku veya Admin okuyabilir
        allow read: if isUser(userId) || isAdmin();
        
        // GÃ¼nlÃ¼k oturum verisi oluÅŸtur/gÃ¼ncelle
        allow write: if isUser(userId);
        
        // Admin silebilir (kullanÄ±cÄ± silme iÃ§in)
        allow delete: if isAdmin();
      }
      
      // ========== TÃœM ALT KOLEKSÄ°YONLAR Ä°Ã‡Ä°N ADMIN SÄ°LME ==========
      // YukarÄ±da tanÄ±mlanmamÄ±ÅŸ herhangi bir alt koleksiyon iÃ§in
      match /{anySubcollection}/{anyDoc} {
        allow read: if isUser(userId) || isAdmin();
        allow delete: if isAdmin();
      }
    }
    
    // ========== TEAMS KOLEKSÄ°YONU ==========
    
    match /teams/{teamId} {
      // Herkes takÄ±m bilgisini okuyabilir (sÄ±ralama amaÃ§lÄ±)
      allow read: if isAuthenticated();
      
      // Lider takÄ±mÄ± oluÅŸturabilir (Cloud Function)
      allow create: if isAuthenticated();
      
      // ðŸš¨ BAÅžDENETÃ‡I FIX #3 REV.2: Lider POZÄ°TÄ°F WHITELIST ile sÄ±nÄ±rlÄ±
      // Sadece takÄ±m profil alanlarÄ±nÄ± gÃ¼ncelleyebilir
      // Stats, Ã¼yelik, yetki alanlarÄ± SERVER-ONLY
      allow update: if isTeamLeader(teamId) &&
                      request.resource.data.diff(resource.data).affectedKeys()
                        .hasOnly([
                          // TakÄ±m profil alanlarÄ±
                          'name', 'description', 'logo_url', 'cover_url',
                          // GÃ¶rÃ¼nÃ¼rlÃ¼k ayarlarÄ±
                          'is_public', 'join_type', 'max_members',
                          // Ä°letiÅŸim
                          'contact_email', 'social_links'
                        ]);
      
      // Admin takÄ±mlarÄ± gÃ¼ncelleyebilir
      allow update: if isAdmin();
      
      // ðŸš¨ BAÅžDENETÃ‡I FIX #3: TakÄ±m istatistikleri client'tan YAZILAMAZ
      // members_count, member_ids, total_team_hope, team_bonus_steps = SERVER ONLY
      // leader_uid, created_by, referral_code = DEÄžÄ°ÅžTÄ°RÄ°LEMEZ
      // joinTeam(), leaveTeam(), convertStepsToHope() Cloud Function'larÄ± yazar
      
      // Lider veya admin takÄ±mÄ± silebilir
      allow delete: if isTeamLeader(teamId) || isAdmin();
      
      // ========== TEAM_MEMBERS ALT KOLEKSÄ°YONU ==========
      
      match /team_members/{memberId} {
        // TakÄ±m Ã¼yeleri herkes tarafÄ±ndan okunabilir
        allow read: if isAuthenticated();
        
        // SEC-002 FIX: Sadece lider Ã¼ye ekleyebilir veya kullanÄ±cÄ± kendini ekleyebilir
        // Cloud Function Admin SDK kullandÄ±ÄŸÄ± iÃ§in bu kuraldan etkilenmez
        allow create: if isTeamLeader(teamId) || isUser(memberId);
        
        // Lider veya Ã¼yenin kendisi gÃ¼ncelleyebilir
        allow update: if isTeamLeader(teamId) || isUser(memberId);
        
        // Lider, admin veya Ã¼yenin kendisi Ã§Ä±kabilir (takÄ±mdan ayrÄ±lma)
        allow delete: if isTeamLeader(teamId) || isAdmin() || isUser(memberId);
      }
    }
    
    // ========== DAILY_STEPS KOLEKSÄ°YONU (DEPRECATED) ==========
    // ðŸš¨ NOT: Bu root koleksiyon artÄ±k KULLANILMIYOR
    // TÃ¼m daily_steps verisi users/{uid}/daily_steps/{dateKey} altÄ±nda
    // Bu kural sadece legacy uyumluluk iÃ§in, client yazamaz
    
    match /daily_steps/{stepId} {
      // Sadece admin okuyabilir (migration iÃ§in)
      allow read: if isAdmin();
      
      // Client yazamaz - tÃ¼m yazma users/{uid}/daily_steps Ã¼zerinden
      allow write: if false;
    }
    
    // ========== ACTIVITY_LOGS ROOT KOLEKSÄ°YONU (Leaderboard iÃ§in) ==========
    
    match /activity_logs/{logId} {
      // Herkes okuyabilir (sÄ±ralama amaÃ§lÄ±)
      allow read: if isAuthenticated();
      
      // BUG-011 FIX: Sadece kendi user_id'si ile log oluÅŸturabilir
      // Cloud Function Admin SDK kullandÄ±ÄŸÄ± iÃ§in bu kuraldan etkilenmez
      allow create: if isAuthenticated() && 
                       request.resource.data.user_id == request.auth.uid;
      
      // Sadece admin gÃ¼ncelleyebilir (baÄŸÄ±ÅŸ transfer durumu iÃ§in)
      allow update: if isAdmin();
      
      // Loglar silinemez
      allow delete: if false;
    }
    
    // ========== CONVERSION_LEDGER KOLEKSÄ°YONU (P2-1: Denetim Ä°zi) ==========
    // ðŸš¨ IMMUTABLE LEDGER: Sadece create, update/delete YASAK
    // Her conversion iÃ§in muhasebe kaydÄ± - deÄŸiÅŸtirilemez
    
    match /conversion_ledger/{ledgerId} {
      // Sadece kendi kayÄ±tlarÄ±nÄ± okuyabilir (admin hariÃ§)
      allow read: if isAuthenticated() && 
                     (request.auth.uid == resource.data.user_id || isAdmin());
      
      // ðŸš¨ CREATE ONLY: Sadece kendi user_id'si ile oluÅŸturabilir
      // idempotency_key ile tekrar yazma engellenir (client tarafÄ±nda)
      allow create: if isAuthenticated() && 
                       request.resource.data.user_id == request.auth.uid &&
                       request.resource.data.idempotency_key != null &&
                       request.resource.data.amount_steps != null &&
                       request.resource.data.amount_hope != null &&
                       request.resource.data.conversion_type != null &&
                       request.resource.data.created_at != null;
      
      // ðŸš¨ UPDATE YASAK: Ledger immutable
      allow update: if false;
      
      // ðŸš¨ DELETE YASAK: Ledger immutable
      allow delete: if false;
    }
    
    // ========== NOTIFICATIONS ROOT KOLEKSÄ°YONU (TakÄ±m davetleri iÃ§in) ==========
    
    match /notifications/{notificationId} {
      // ðŸš¨ BAÅžDENETÃ‡I FIX #5 REV.2: Sadece hedef kullanÄ±cÄ± veya gÃ¶nderen okuyabilir
      // Eski dokÃ¼manlar iÃ§in null kontrolÃ¼ eklendi
      allow read: if isAuthenticated() && 
                    (
                      (resource.data.to_user_id != null && resource.data.to_user_id == request.auth.uid) || 
                      (resource.data.from_user_id != null && resource.data.from_user_id == request.auth.uid) ||
                      (resource.data.user_id != null && resource.data.user_id == request.auth.uid)
                    );
      
      // Bildirim oluÅŸturabilir - from_user_id doÄŸrulamasÄ±
      allow create: if isAuthenticated() && 
                       request.resource.data.from_user_id == request.auth.uid;
      
      // ðŸš¨ Sadece hedef kullanÄ±cÄ± gÃ¼ncelleyebilir (kabul/reddet)
      // Null kontrolÃ¼ ile eski dokÃ¼manlar korunur
      allow update: if isAuthenticated() && 
                      resource.data.to_user_id != null &&
                      resource.data.to_user_id == request.auth.uid;
      
      // ðŸš¨ Sadece hedef kullanÄ±cÄ± veya gÃ¶nderen silebilir
      allow delete: if isAuthenticated() && 
                      (
                        (resource.data.to_user_id != null && resource.data.to_user_id == request.auth.uid) || 
                        (resource.data.from_user_id != null && resource.data.from_user_id == request.auth.uid)
                      );
    }
    
    // ========== CHARITIES KOLEKSÄ°YONU ==========
    
    match /charities/{charityId} {
      // Herkes vakÄ±f listesini okuyabilir
      allow read: if isAuthenticated();
      
      // Admin tam yetki
      allow write: if isAdmin();
      
      // ðŸš¨ BAÅžDENETÃ‡I FIX #6: Client collected_amount/donor_count YAZAMAZ
      // Sadece donateHope() Cloud Function (Admin SDK) gÃ¼nceller
      // KALDIRILDI: allow update: if isAuthenticated() && hasOnly collected_amount...
    }
    
    // ========== DONATIONS KOLEKSÄ°YONU ==========
    
    match /donations/{donationId} {
      // Admin tÃ¼m baÄŸÄ±ÅŸlarÄ± okuyabilir
      allow read: if isAdmin();
      
      // KullanÄ±cÄ± kendi baÄŸÄ±ÅŸlarÄ±nÄ± okuyabilir
      allow read: if isAuthenticated() && resource.data.user_id == request.auth.uid;
      
      // BaÄŸÄ±ÅŸ oluÅŸturma (Cloud Function veya kullanÄ±cÄ±)
      allow create: if isAuthenticated();
      
      // Sadece admin gÃ¼ncelleyebilir
      allow update: if isAdmin();
      
      // Silinmez
      allow delete: if false;
    }
    
    // ========== ADMINS KOLEKSÄ°YONU ==========
    
    match /admins/{adminId} {
      // Sadece kendi admin doc'unu okuyabilir (gizlilik iÃ§in)
      // Admin listesi gerekiyorsa adminler iÃ§in ayrÄ± query
      allow read: if isAuthenticated() && (request.auth.uid == adminId || isAdmin());
      
      // Admin ekleme sadece mevcut adminler (Super Admin)
      allow write: if isAdmin();
    }
    
    // ========== ADMIN_STATS KOLEKSÄ°YONU ==========
    
    match /admin_stats/{statId} {
      // Sadece adminler okuyabilir
      allow read: if isAdmin();
      
      // Cloud Function gÃ¼nceller
      allow write: if isAdmin();
    }
    
    // ========== ADMIN_LOGS KOLEKSÄ°YONU ==========
    
    match /admin_logs/{logId} {
      // Sadece adminler okuyabilir
      allow read: if isAdmin();
      
      // Admin iÅŸlem yaptÄ±ÄŸÄ±nda log oluÅŸturur
      allow create: if isAdmin();
      
      // Loglar silinemez/gÃ¼ncellenemez
      allow update, delete: if false;
    }
    
    // ========== BADGE_DEFINITIONS KOLEKSÄ°YONU ==========
    
    match /badge_definitions/{badgeId} {
      // Herkes rozet tanÄ±mlarÄ±nÄ± okuyabilir
      allow read: if isAuthenticated();
      
      // Sadece admin ekleyebilir/gÃ¼ncelleyebilir/silebilir
      allow write: if isAdmin();
    }
    
    // ========== BROADCAST_NOTIFICATIONS KOLEKSÄ°YONU ==========
    
    match /broadcast_notifications/{notificationId} {
      // Admin okuyabilir
      allow read: if isAdmin();
      
      // Admin gÃ¶nderebilir
      allow create: if isAdmin();
      
      // Silinemez
      allow delete: if false;
    }
    
    // ========== SCHEDULED_NOTIFICATIONS KOLEKSÄ°YONU ==========
    
    match /scheduled_notifications/{notificationId} {
      // Admin okuyabilir
      allow read: if isAdmin();
      
      // Admin oluÅŸturabilir/gÃ¼ncelleyebilir
      allow create, update: if isAdmin();
      
      // Admin silebilir
      allow delete: if isAdmin();
    }
    
    // ========== DAILY_STATS KOLEKSÄ°YONU ==========
    
    match /daily_stats/{dateKey} {
      // Admin okuyabilir
      allow read: if isAdmin();
      
      // Cloud Function gÃ¼nceller
      allow write: if isAdmin();
    }
    
    // ========== AD_LOGS KOLEKSÄ°YONU (Reklam Takibi) ==========
    
    match /ad_logs/{logId} {
      // Admin tÃ¼m reklam loglarÄ±nÄ± okuyabilir
      allow read: if isAdmin();
      
      // Oturum aÃ§mÄ±ÅŸ kullanÄ±cÄ±lar reklam logu oluÅŸturabilir
      allow create: if isAuthenticated();
      
      // Loglar silinemez/gÃ¼ncellenemez
      allow update, delete: if false;
    }
    
    // ========== AD_ERRORS KOLEKSÄ°YONU (Reklam HatalarÄ±) ==========
    
    match /ad_errors/{errorId} {
      // Admin tÃ¼m hata loglarÄ±nÄ± okuyabilir
      allow read: if isAdmin();
      
      // Herkes (oturum aÃ§mÄ±ÅŸ) hata logu oluÅŸturabilir
      allow create: if isAuthenticated();
      
      // Loglar silinemez/gÃ¼ncellenemez
      allow update, delete: if false;
    }
    
    // ========== STEP_LEADERBOARD KOLEKSÄ°YONU ==========
    
    match /step_leaderboard/{docId} {
      // Herkes sÄ±ralamayÄ± okuyabilir
      allow read: if isAuthenticated();
      
      // Cloud Function tarafÄ±ndan gÃ¼ncellenir
      allow write: if false;
    }
    
    // ========== DONATION_LEADERBOARD KOLEKSÄ°YONU ==========
    
    match /donation_leaderboard/{docId} {
      // Herkes sÄ±ralamayÄ± okuyabilir
      allow read: if isAuthenticated();
      
      // Cloud Function tarafÄ±ndan gÃ¼ncellenir
      allow write: if false;
    }
    
    // ========== CHARITY_COMMENTS KOLEKSÄ°YONU ==========
    
    match /charity_comments/{commentId} {
      // Herkes yorumlarÄ± okuyabilir
      allow read: if isAuthenticated();
      
      // Oturum aÃ§mÄ±ÅŸ kullanÄ±cÄ±lar yorum ekleyebilir
      allow create: if isAuthenticated() && 
                       request.resource.data.user_id == request.auth.uid;
      
      // Kendi yorumunu silebilir veya admin silebilir
      allow delete: if (isAuthenticated() && resource.data.user_id == request.auth.uid) || isAdmin();
    }
    
    // ========== HOPE_LEADERBOARD KOLEKSÄ°YONU ==========
    
    match /hope_leaderboard/{docId} {
      // Herkes sÄ±ralamayÄ± okuyabilir
      allow read: if isAuthenticated();
      
      // ðŸš¨ BAÅžDENETÃ‡I FIX #4: Client YAZAMAZ - sadece Cloud Function (Admin SDK)
      allow write: if false;
    }
    
    // ========== TEAM_LEADERBOARD KOLEKSÄ°YONU ==========
    
    match /team_leaderboard/{docId} {
      // Herkes takÄ±m sÄ±ralamasÄ±nÄ± okuyabilir
      allow read: if isAuthenticated();
      
      // ðŸš¨ BAÅžDENETÃ‡I FIX #4: Client YAZAMAZ - sadece Cloud Function (Admin SDK)
      allow write: if false;
    }
    
    // ========== INVITATIONS KOLEKSÄ°YONU ==========
    
    match /invitations/{inviteId} {
      // Davetleri okuma ve yazma
      allow read, write: if isAuthenticated();
    }
    
    // ========== USER_BADGES KOLEKSÄ°YONU ==========
    
    match /user_badges/{docId} {
      // KullanÄ±cÄ± rozetlerini okuma ve yazma
      allow read, write: if isAuthenticated();
    }
    
    // ========== APP_SETTINGS KOLEKSÄ°YONU ==========
    
    match /app_settings/{docId} {
      // Herkes ayarlarÄ± okuyabilir
      allow read: if isAuthenticated();
      
      // Sadece admin gÃ¼ncelleyebilir
      allow write: if isAdmin();
    }
    
    // ========== MONTHLY_HOPE_VALUE KOLEKSÄ°YONU ==========
    
    match /monthly_hope_value/{monthKey} {
      // Sadece admin okuyabilir (kullanÄ±cÄ±lar gÃ¶rmemeli)
      allow read: if isAdmin();
      
      // Cloud Function tarafÄ±ndan yazÄ±lÄ±r, admin gÃ¼ncelleyebilir
      allow write: if isAdmin();
    }
    
    // ========== AD_REVENUE_HISTORY KOLEKSÄ°YONU ==========
    
    match /ad_revenue_history/{docId} {
      // Sadece admin okuyabilir
      allow read: if isAdmin();
      
      // Cloud Function tarafÄ±ndan yazÄ±lÄ±r
      allow write: if isAdmin();
    }
    
    // ========== MAIL KOLEKSIYONU (Firebase Trigger Email Extension) ==========
    
    match /mail/{mailId} {
      // Sadece Cloud Function yazabilir (client yazamaz)
      allow read, write: if false;
    }
    
    // ========== VERIFICATION CODES KOLEKSIYONU ==========
    
    match /verification_codes/{codeId} {
      // Sadece Cloud Function eriÅŸebilir
      allow read, write: if false;
    }
    
    // ========== PASSWORD RESET CODES KOLEKSIYONU ==========
    
    match /password_reset_codes/{codeId} {
      // Sadece Cloud Function eriÅŸebilir
      allow read, write: if false;
    }
    
    // ========== CATCH ALL (GÃ¼venli VarsayÄ±lan) ==========
    
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

/*
AÃ‡IKLAMALAR:

1. USERS Koleksiyonu:
   - Kendi profilinizi okuyabilirsiniz
   - Kendi profilinizi gÃ¼ncelleyebilirsiniz (uid, email, created_at korumalÄ±)
   - DiÄŸer kullanÄ±cÄ±larÄ± okuyabilirsiniz (sÄ±ralama amaÃ§lÄ±)

2. NOTIFICATIONS:
   - Sadece kendi bildirimlerinizi okuyabilirsiniz
   - Cloud Function bildirimleri oluÅŸturur/gÃ¼nceller

3. TEAMS:
   - Herkes takÄ±mlarÄ± gÃ¶rebilir (sÄ±ralama)
   - Lider takÄ±mÄ± yÃ¶netebilir
   - team_members alt koleksiyonu herkese aÃ§Ä±k

4. DAILY_STEPS:
   - Kendi adÄ±m verinizi gÃ¶rÃ¼rsÃ¼nÃ¼z
   - Cloud Function tarafÄ±ndan yÃ¶netilir

5. CHARITIES:
   - Herkes vakÄ±flarÄ± gÃ¶rebilir
   - Admin tarafÄ±ndan yÃ¶netilir (Cloud Functions)

6. LEADERBOARDS:
   - Herkes sÄ±ralamalarÄ± gÃ¶rebilir
   - Cloud Function tarafÄ±ndan otomatik gÃ¼ncellenir

ENDEKSLER (Firestore Console'da oluÅŸtur):
- collections/teams fields(referral_code) UNIQUE
- collections/daily_steps fields(user_id, date DESC)
- collections/users fields(current_team_id)
*/
